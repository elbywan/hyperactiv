!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e["hyperactiv-websocket"]=t()}(this,function(){"use strict";return(e,t,n,r)=>{const s={},o=new WebSocket(e||"ws://localhost:8080"),a=function(e){if(!e)throw new Error("writeHandler needs a proper target !");return function(t,n){n=(r=n)&&"object"==typeof r?JSON.parse(JSON.stringify(n)):n;var r;for(let n=0;n<t.length-1;n++){const r=t[n],o=t[n+1];void 0===e[r]&&(e[r]=(s=o,Number.isInteger(Number.parseInt(s))?[]:{})),e=e[r]}var s;e[t[t.length-1]]=n}}(t);let i=0;o.addEventListener("message",e=>{e=JSON.parse(e.data),n&&n(e),"sync"==e.type?("function"==typeof t?t=t(e.state):Object.assign(t,e.state),Array.isArray(e.methods)&&e.methods.forEach(e=>a(e,async(...t)=>(o.send(JSON.stringify({type:"call",keys:e,args:t,request:++i})),new Promise((t,n)=>{s[i]=t,setTimeout(()=>{delete s[i],n(new Error("Timeout on call to "+e))},r||15e3)}))))):"update"==e.type?a(e.keys,e.value):"response"==e.type&&(s[e.request](e.result),delete s[e.request])}),o.addEventListener("open",()=>o.send("sync"))}});
