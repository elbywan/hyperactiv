!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.hyperactiv=t()}(this,function(){"use strict";const e=[],t=new WeakMap,n=function(e){return e&&"object"==typeof e},u=Array.isArray,o=function(e,t,n){Object.defineProperty(e,"__key",{value:t,enumerable:!1,configurable:!0}),Object.defineProperty(e,"__parent",{value:n,enumerable:!1,configurable:!0})},r={timeout:null,queue:new Set,process(){for(const e of r.queue)e();r.queue.clear(),r.timeout=null},enqueue(e){null===r.timeout&&(r.timeout=setTimeout(r.process,0)),r.queue.add(e)}},c=function(i,s={}){const{props:f=null,ignore:l=null,batch:p=!1,deep:a=!1,handler:d=null,bind:y=!1}=s;if(i.__observed)return i;t.set(i,new Map),a&&Object.entries(i).forEach(function([e,t]){n(t)&&(i[e]=c(t,s),d&&o(i[e],e,i))});const b=new Proxy(i,{get(n,u){if("__observed"===u)return!0;if((!f||f.includes(u))&&(!l||!l.includes(u))&&e.length){const n=t.get(i);n.has(u)||n.set(u,new Set),n.get(u).add(e[0])}return i[u]},set(y,_,h){const m=t.get(i);if((!u(i)||"length"!==_)&&i[_]===h)return!0;if(i[_]=a&&n(h)?c(h,s):h,d&&a&&n(h)&&o(i[_],_,i),d){const e=[_];let t=i;for(;t.__key&&t.__parent;)e.unshift(t.__key),t=t.__parent;d(e,h,b)}if((!f||f.includes(_))&&(!l||!l.includes(_))&&m.has(_)){const t=m.get(_);for(const n of t)n.__disposed?t.delete(n):n!==e[0]&&(p?r.enqueue(n):n())}return!0}});if(y){[...Object.getOwnPropertyNames(i),...Object.getOwnPropertyNames(Object.getPrototypeOf(i))].filter(e=>"constructor"!=e&&"function"==typeof i[e]).forEach(e=>i[e]=i[e].bind(b))}return b};return{observe:c,computed:function(t,{autoRun:n=!0,callback:u=null,bind:o=null}={}){const r=new Proxy(t,{apply(t,n,c){const i=function(i=null){e.unshift(u||r);const s=i?i():t.apply(o||n,c);return e.shift(),s};return c.push({computeAsync:function(e){return i(e)}}),i()}});return n&&r(),r},dispose:function(e){return e.__disposed=!0}}});
