!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e["react-hyperactiv"]={},e.React)}(this,function(e,t){"use strict";const n=[],r=new WeakMap,o=function(e){return e&&"object"==typeof e&&!(e instanceof Date)},u=Array.isArray,c=function(e,t,n,r){Object.defineProperty(e,"__key",{value:t,enumerable:!1,configurable:!0}),Object.defineProperty(e,"__parent",{value:n,enumerable:!1,configurable:!0}),r&&Object.entries(e).forEach(function([t,n]){!o(n)||n.__key&&n.__parent||c(e[t],t,e)})},i={timeout:null,queue:new Set,process(){for(const e of i.queue)e();i.queue.clear(),i.timeout=null},enqueue(e){null===i.timeout&&(i.timeout=setTimeout(i.process,0)),i.queue.add(e)}},s=function(e,t={}){const{props:a=null,ignore:l=null,batch:p=!1,deep:f=!0,bubble:d=null,bind:_=!1}=t;if(e.__observed)return e;r.set(e,new Map),f&&Object.entries(e).forEach(function([n,r]){o(r)&&(e[n]=s(r,t),d&&c(e[n],n,e))});const b=new Proxy(e,{get(t,o){if("__observed"===o)return!0;if((!a||a.includes(o))&&(!l||!l.includes(o))&&n.length){const t=r.get(e);t.has(o)||t.set(o,new Set),t.get(o).add(n[0])}return e[o]},set(_,y,h){if("__handler"===y)Object.defineProperty(e,"__handler",{value:h,enumerable:!1,configurable:!0});else{const _=r.get(e);if((!u(e)||"length"!==y)&&e[y]===h)return!0;const m=e[y];if(o(m)&&(delete m.__key,delete m.__parent),e[y]=f&&o(h)?s(h,t):h,f&&o(h)&&(d||e.__parent)&&c(e[y],y,e,f),!e.__handler||!1!==e.__handler([y],h,m,b)){const t=[e.__key,y];let n=e.__parent;for(;n&&(!n.__handler||!1!==n.__handler(t,h,m,b));)n.__key&&n.__parent?(t.unshift(n.__key),n=n.__parent):n=null}if((!a||a.includes(y))&&(!l||!l.includes(y))&&_.has(y)){const e=_.get(y);for(const t of e)t.__disposed?e.delete(t):t!==n[0]&&(p?i.enqueue(t):t())}}return!0},deleteProperty(e,t){const n=e[t];return o(n)&&(delete n.__key,delete n.__parent),delete e[t],!0}});if(_){[...Object.getOwnPropertyNames(e),...Object.getPrototypeOf(e)&&["String","Number","Object","Array","Boolean","Date"].indexOf(Object.getPrototypeOf(e).constructor.name)<0?Object.getOwnPropertyNames(Object.getPrototypeOf(e)):[]].filter(t=>"constructor"!=t&&"function"==typeof e[t]).forEach(t=>e[t]=e[t].bind(b))}return b};var a={observe:s,computed:function(e,{autoRun:t=!0,callback:r=null,bind:o=null}={}){const u=new Proxy(e,{apply(e,t,c){const i=function(i=null){n.unshift(r||u);const s=i?i():e.apply(o||t,c);return n.shift(),s};return c.push({computeAsync:function(e){return i(e)}}),i()}});return t&&u(),u},dispose:function(e){return e.__disposed=!0}};const{observe:l,computed:p,dispose:f}=a,d=e=>(class extends t.PureComponent{constructor(t,n){super(t,n),this.wrap=p(e,{autoRun:!1,callback:this.forceUpdate.bind(this)})}render(){return this.wrap(this.props)}componentWillUnmount(){f(this.wrap)}});var _;e.watch=(e=>e.prototype.render?(_=e,new Proxy(_,{construct:function(e,t){const n=new e(...t);n.forceUpdate=n.forceUpdate.bind(n);const r="function"==typeof n.componentWillUnmount&&n.componentWillUnmount.bind(n)();return n.componentWillUnmount=function(...e){f(n.forceUpdate),r&&r(...e)},new Proxy(n,{get:function(e,t){return"render"===t?p(e.render.bind(e),{autoRun:!1,callback:n.forceUpdate}):e[t]}})}})):d(e)),e.store=(e=>l(e,{deep:!0})),Object.defineProperty(e,"__esModule",{value:!0})});
