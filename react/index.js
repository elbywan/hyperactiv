!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e["react-hyperactiv"]={},e.React)}(this,function(e,t){"use strict";const n=[],o=new WeakMap,r=function(e){return e&&"object"==typeof e&&!(e instanceof Date)},u=Array.isArray,c=function(e,t,n,o){Object.defineProperty(e,"__key",{value:t,enumerable:!1,configurable:!0}),Object.defineProperty(e,"__parent",{value:n,enumerable:!1,configurable:!0}),o&&Object.entries(e).forEach(function([t,n]){!r(n)||n.__key&&n.__parent||c(e[t],t,e)})},s={timeout:null,queue:new Set,process(){for(const e of s.queue)e();s.queue.clear(),s.timeout=null},enqueue(e){null===s.timeout&&(s.timeout=setTimeout(s.process,0)),s.queue.add(e)}},i=function(e,{autoRun:t=!0,callback:o=null,bind:r=null}={}){const u=new Proxy(e,{apply(e,t,c){const s=function(s=null){n.unshift(o||u);const i=s?s():e.apply(r||t,c);return n.shift(),i};return c.push({computeAsync:function(e){return s(e)}}),s()}});return t&&u(),u},p=function(e){return e.__disposed=!0},a=function(e,t={}){const{props:i=null,ignore:p=null,batch:l=!1,deep:d=!1,bubble:f=null,bind:_=!1}=t;if(e.__observed)return e;o.set(e,new Map),d&&Object.entries(e).forEach(function([n,o]){r(o)&&(e[n]=a(o,t),f&&c(e[n],n,e))});const b=new Proxy(e,{get(t,r){if("__observed"===r)return!0;if((!i||i.includes(r))&&(!p||!p.includes(r))&&n.length){const t=o.get(e);t.has(r)||t.set(r,new Set),t.get(r).add(n[0])}return e[r]},set(_,h,y){if(f&&"__handler"===h)return e.__handler=y,!0;const m=o.get(e);if((!u(e)||"length"!==h)&&e[h]===y)return!0;const g=e[h];if(e[h]=d&&r(y)?a(y,t):y,f&&d&&r(y)&&c(e[h],h,e,d),e.__handler||e.__parent){const t=[h];let n=e;for(;n&&(!n.__handler||!1!==n.__handler(t,y,g,b));)n.__key&&n.__parent?(t.unshift(n.__key),n=n.__parent):n=null}if((!i||i.includes(h))&&(!p||!p.includes(h))&&m.has(h)){const e=m.get(h);for(const t of e)t.__disposed?e.delete(t):t!==n[0]&&(l?s.enqueue(t):t())}return!0}});if(_){[...Object.getOwnPropertyNames(e),...Object.getPrototypeOf(e)&&["String","Number","Object","Array","Boolean","Date"].indexOf(Object.getPrototypeOf(e).constructor.name)<0?Object.getOwnPropertyNames(Object.getPrototypeOf(e)):[]].filter(t=>"constructor"!=t&&"function"==typeof e[t]).forEach(t=>e[t]=e[t].bind(b))}return b};var l={observe:a,computed:i,dispose:p,Observable:e=>(class extends e{constructor(e,t){super();const n=a(e||{},t||{deep:!0,batch:!0});return new Proxy(this,{set:(e,t,o)=>("function"==typeof o?this[t]=o:(n[t]=o,void 0===this[t]&&Object.defineProperty(this,t,{get:()=>n[t],enumerable:!0,configurable:!0})),!0),deleteProperty:(e,t)=>(delete n[t],delete e[t],!0)})}}),Computable:e=>(class extends e{constructor(){super(),Object.defineProperty(this,"__computed",{value:[],enumerable:!1})}computed(e){this.__computed.push(i(e))}dispose(){for(;this.__computed.length;)p(this.__computed.pop())}})};const{observe:d,computed:f,dispose:_}=l,b=e=>(class extends t.PureComponent{constructor(t,n){super(t,n),this.wrap=f(e,{autoRun:!1,callback:this.forceUpdate.bind(this)})}render(){return this.wrap(this.props)}componentWillUnmount(){_(this.wrap)}});var h;e.watch=(e=>e.prototype.render?(h=e,new Proxy(h,{construct:function(e,t){const n=new e(...t);n.forceUpdate=n.forceUpdate.bind(n);const o="function"==typeof n.componentWillUnmount&&n.componentWillUnmount.bind(n)();return n.componentWillUnmount=function(...e){_(n.forceUpdate),o&&o(...e)},new Proxy(n,{get:function(e,t){return"render"===t?f(e.render.bind(e),{autoRun:!1,callback:n.forceUpdate}):e[t]}})}})):b(e)),e.store=(e=>d(e,{deep:!0})),Object.defineProperty(e,"__esModule",{value:!0})});
